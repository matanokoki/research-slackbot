# Slack 業務効率化 Chatbot (Summarize Bot)

## 1. プロジェクト概要
本プロジェクトは、Slack内の膨大な会話ログから必要な情報を即座に抽出し、時系列で要約・整理するためのAIチャットボットです。
過去の経緯を追う時間を大幅に削減し、意思決定の迅速化とナレッジの資産化を目的としています。

## 2. 主な機能
- **時系列要約**: 指定した話題について過去の会話を遡り、経緯・決定事項を時系列でまとめます。
- **場所の特定（リンク機能）**: 要約結果から、実際の発言場所（Slack上のメッセージ）へ直接ジャンプできるリンクを提供します。
- **キーワード検索**: ワークスペース全体（権限範囲内）から特定のトピックを横断検索します。
- **チャンネル構成表示**: ユーザーがアクセス権限を持つチャンネルのみを一覧表示します。

## 3. セキュリティ・プライバシー（重要）
- **データの学習防止**: Google Gemini API（有料版/エンタープライズ枠）を利用し、送信されたデータがAIモデルの学習に再利用されない設定で運用します（NDA準拠）。
- **権限の遵守**: 実行ユーザー自身のトークンを使用して情報を取得するため、ユーザーが閲覧権限を持たない非公開チャンネルの情報が漏洩することはありません。

## 4. 動作環境・ライブラリ
以下の環境およびライブラリが必要です。

### 必須環境
- Python 3.11 以上
- Google Gemini API キー
- Slack App 認証情報（Bot Token, User Token, App-Level Token）

### 依存ライブラリ
- `slack_bolt`: Slackアプリ開発フレームワーク
- `google-genai`: 最新のGoogle AI SDK
- `python-dotenv`: 環境変数管理

## 5. 環境設定ガイド（トークンの取得方法）

本ボットを動作させるには、以下の4つの認証情報が必要です。

### 1. Slack API トークン
[Slack API 管理画面](https://api.slack.com/apps)にアクセスし、対象のアプリ(検索アプリ)を選択して取得します。

* **SLACK_BOT_TOKEN** (`xoxb-...`)
    - 取得場所: `OAuth & Permissions` > `Bot User OAuth Token`
    - 必要なScope: `chat:write`, `commands`, `channels:read`, `groups:read`
* **SLACK_USER_TOKEN** (`xoxp-...`)
    - 取得場所: `OAuth & Permissions` > `User OAuth Token`
    - 必要なScope: `search:read`
* **SLACK_APP_TOKEN** (`xapp-...`)
    - 取得場所: `Basic Information` > `App-Level Tokens`
    - ※Socket Modeを有効にするために必要です。

### 2. Google Gemini API キー
[Google AI Studio](https://aistudio.google.com/) にアクセスして取得します。

* **GEMINI_API_KEY**
    - 取得場所: 「Get API key」ボタンから新規発行。
    - ※本プロジェクトでは、最新の安定モデル（Gemini 1.5 Flash / Pro 等）を使用します。

### 3. .env ファイルの作成
プロジェクトのルートディレクトリ（`main.py`と同じ階層）に `.env` という名前のファイルを作成し、以下の形式で取得したトークンを記入してください。

    SLACK_BOT_TOKEN=xoxb-あなたのトークン
    SLACK_USER_TOKEN=xoxp-あなたのトークン
    SLACK_APP_TOKEN=xapp-あなたのトークン
    GEMINI_API_KEY=あなたのAPIキー

※ .env ファイルはセキュリティ上の理由により、GitHub等の共有リポジトリにはアップロードしないでください。

## 6. セットアップ手順
1. 本リポジトリをクローンまたはダウンロードします。
2. 必要なライブラリをインストールします。
   ```bash
   pip install -r requirements.txt
3. .env ファイルに各トークンを記載します。
4. ボットを起動します。
    ```bash
    python main.py
## 7. 使い方（コマンド一覧）

Slackのメッセージ入力欄に以下のコマンドを入力して実行します。

### 自由質問・戦略分析モード（推奨）
> **コマンド:** `/ask [具体的な指示や質問]`

「社内ログをすべて把握している参謀」に自由に相談できるモードです。
- **実行例1（課題抽出）**: `/ask プロジェクトBの遅延原因と、誰がボトル名になっているか整理して`
- **実行例2（ネガ・ポジ分析）**: `/ask 新システム導入について、現場メンバーが懸念している点だけを抜き出して`
- **実行例3（要旨作成）**: `/ask 今週の定例スレッドの決定事項を、役員報告用に140文字でまとめて`
- **特徴**: 単なる要約ではなく、指示の意図を汲み取った「インサイト（洞察）」を提供します。

### 会話の要約・検索
> **コマンド:** `/summarize [検索キーワード]`

- **実行例**: `/summarize プロジェクトA 予算案`
- **処理内容**: 
    1. 指定されたキーワードでワークスペース内を横断検索（最大20件）。
    2. 取得したメッセージを時系列に整列。
    3. AI（Gemini）が「議論の変遷」「決定事項」「次のアクション」を構造化して出力。
- **場所の特定機能**: 
    要約文の各項目に **`[元の会話を表示]`** という青色のリンクが付与されます。これをクリックすることで、ブラウザまたはSlackアプリが自動的にその発言場所までスクロールします。

### アクセス可能なチャンネルの確認
> **コマンド:** `/list-channels`

- **処理内容**: 
    現在ログインしているユーザー（あなた）が参加している、あるいはアクセス可能な公開・非公開チャンネルを一覧表示します。ボットがどの範囲で情報を取得できるかを確認する際に便利です。

---

## 8. 運用のコツと導入メリット

### 運用のコツ（検索精度の向上）
1. **期間の指定**: キーワードに「1月」「先週」などの時期を追加することで、特定の期間に絞った高精度な要約が可能です。
2. **チャンネルへの招待**: 非公開チャンネルの内容を要約対象に含めるには、そのチャンネル内で `/invite @ボット名` を実行し、ボットをメンバーに加えてください。
3. **ナレッジの資産化**: 議論が白熱したスレッドや会議後のまとめとして本コマンドを実行し、生成された要約を「ピン留め」しておくことで、後から参加したメンバーのキャッチアップコストをゼロにします。

### 導入によるビジネスメリット
| メリット | 具体的な効果 |
| :--- | :--- |
| **工数削減** | 数十分かかる過去ログの読み込みを数秒に短縮。 |
| **情報の透明化** | 「言った・言わない」の防止。決定事項のログがリンク付きで残る。 |
| **セキュリティ** | 既存のSlack権限を遵守し、AI学習にデータを使わせない安全な運用。 |
| **低コスト** | 既存資産（PC/クラウド無料枠）の活用で、追加投資を抑えたDXを実現。 |